<launch>

  <!-- Arguments -->

  <!-- Image arguments -->
  <arg name = "resolution" default = "full"/>
  <arg name = "stereo" default = "stereo_down"/>
  <arg name = "camera" default = "/stereo_down"/>
  <arg name = "enable_decimate_x1" default = "true"/>
  <arg name = "enable_decimate_x2" default = "false"/>
  <arg name = "enable_decimate_x4" default = "false"/>
  <arg name = "images_approximate_sync" default = "true"/>

  <!-- Odometer arguments -->
  <arg name = "viso2_processor" default = "false"/>
  <arg name = "bucketing" default = "false"/>
  <arg name = "feature_tracker" value = "2"/> <!-- 0: SIFT_SIFT, 1: FAST_SIFT, 2: FAST_ORB -->
  <arg name = "epipolar_constrain" value = "1"/>

  <!-- Frame arguments -->
  <!-- <arg name = "base_link" default = "turbot/base_link"/>
  <arg name = "sensor" default = "turbot/stereo_down/left_optical"/> -->
  <arg name = "base_link" default = "sparus2"/>
  <arg name = "sensor" default = "left_optical"/>

  <!-- Parameters -->
  <param name="/use_sim_time" value = "true"/>

  <!-- Bagfiles -->

  <!-- Illetes replanning -->
  <!-- <arg name = "bagfile" default = "/home/uib/bagfiles/illetes/2021_03_18/12_33_24/images_2021-03-18-12-33-25_0.bag"/> -->

  <!-- Cala Lliteres. No es un bon survey però funciona -->
  <!-- <arg name = "bagfile" default = "/home/uib/bagfiles/cala_lliteres/2020_07_23_cala_lliteres/15_51_42/images_2020-07-23-15-51-43_0.bag
                                    /home/uib/bagfiles/cala_lliteres/2020_07_23_cala_lliteres/15_51_42/images_2020-07-23-16-02-04_1.bag
                                    /home/uib/bagfiles/cala_lliteres/2020_07_23_cala_lliteres/15_51_42/images_2020-07-23-16-12-25_2.bag
                                    /home/uib/bagfiles/cala_lliteres/2020_07_23_cala_lliteres/15_51_42/images_2020-07-23-16-22-45_3.bag"/> -->

  <!-- Bendinat hivern. Bon dataset amb molt de features però no funciona a l'odometre no se perquè -->
  <!-- <arg name = "bagfile" default = "/home/uib/bagfiles/bendinat/12_24_51/images_2021-01-19-12-31-10_1.bag" /> -->

  <!-- <arg name = "bagfile" default = "/home/uib/bagfiles/bendinat/2020_07_21/17_14_56/images_2020-07-21-17-14-57_0.bag
                                  /home/uib/bagfiles/bendinat/2020_07_21/17_14_56/images_2020-07-21-17-25-08_1.bag
                                  /home/uib/bagfiles/bendinat/2020_07_21/17_14_56/images_2020-07-21-17-35-22_2.bag
                                  /home/uib/bagfiles/bendinat/2020_07_21/17_14_56/images_2020-07-21-17-45-29_3.bag
                                  /home/uib/bagfiles/bendinat/2020_07_21/17_14_56/images_2020-07-21-17-55-38_4.bag
                                  /home/uib/bagfiles/bendinat/2020_07_21/17_14_56/images_2020-07-21-18-05-47_5.bag
                                  /home/uib/bagfiles/bendinat/2020_07_21/17_14_56/images_2020-07-21-18-16-02_6.bag
                                  /home/uib/bagfiles/bendinat/2020_07_21/17_14_56/images_2020-07-21-18-26-12_7.bag
                                  /home/uib/bagfiles/bendinat/2020_07_21/17_14_56/images_2020-07-21-18-36-23_8.bag" /> -->


  <!-- Portals Vells -->
  <!-- <arg name = "bagfile" default = "/home/uib/bagfiles/portals/2021_02_25/14_41_06/images_2021-02-25-14-41-06_0.bag
                                    /home/uib/bagfiles/portals/2021_02_25/14_41_06/images_2021-02-25-14-47-26_1.bag
                                    /home/uib/bagfiles/portals/2021_02_25/14_41_06/images_2021-02-25-14-53-45_2.bag
                                    /home/uib/bagfiles/portals/2021_02_25/14_41_06/images_2021-02-25-15-00-04_3.bag
                                    /home/uib/bagfiles/portals/2021_02_25/14_41_06/images_2021-02-25-15-06-23_4.bag
                                    /home/uib/bagfiles/portals/2021_02_25/14_41_06/images_2021-02-25-15-12-43_5.bag"/> -->
                                    <!-- /home/uib/bagfiles/portals/2021_02_25/14_41_06/topics_2021-02-25-14-41-52_0.bag"/> -->

  <!-- <arg name = "bagfile" default = "/home/uib/bagfiles/colonia_sant_jordi/2020_11_03/16_46_15/images_2020-11-03-16-46-15_0.bag
                                    /home/uib/bagfiles/colonia_sant_jordi/2020_11_03/16_46_15/images_2020-11-03-16-52-34_1.bag
                                    /home/uib/bagfiles/colonia_sant_jordi/2020_11_03/16_46_15/images_2020-11-03-16-58-54_2.bag
                                    /home/uib/bagfiles/colonia_sant_jordi/2020_11_03/16_46_15/images_2020-11-03-17-05-13_3.bag
                                    /home/uib/bagfiles/colonia_sant_jordi/2020_11_03/16_46_15/images_2020-11-03-17-11-32_4.bag"/> -->
                                    <!-- /home/uib/bagfiles/colonia_sant_jordi/2020_11_04/topics_2020-11-04-15-22-32_0.bag"/> -->
 

  <!-- <arg name = "bagfile" default = "/home/uib/bagfiles/colonia_sant_jordi/2020_11_03/11_17_42/images_2020-11-03-11-17-43_0.bag
                                  /home/uib/bagfiles/colonia_sant_jordi/2020_11_03/11_17_42/images_2020-11-03-11-25-22_1.bag"/> -->

  <!-- <arg name = "bagfile" default = "/home/uib/bagfiles/andratx/2021_06_09/14_33_35/images_2021-06-09-14-33-36_0.bag
                                  /home/uib/bagfiles/andratx/2021_06_09/14_33_35/images_2021-06-09-14-39-55_1.bag
                                  /home/uib/bagfiles/andratx/2021_06_09/14_33_35/images_2021-06-09-14-46-17_2.bag
                                  /home/uib/bagfiles/andratx/2021_06_09/14_33_35/images_2021-06-09-14-52-39_3.bag
                                  /home/uib/bagfiles/andratx/2021_06_09/14_33_35/images_2021-06-09-14-58-59_4.bag"/> -->

  <!-- <arg name = "bagfile" default = "/home/uib/bagfiles/bendinat/2021_01_19/16_33_57/images_2021-01-19-16-33-58_0.bag"/> -->

  <!-- <arg name = "bagfile" default = "/home/uib/bagfiles/colonia_sant_jordi/2021_05_19/15_41_48/images_2021-05-19-15-41-49_0.bag"/>  -->

  <!-- Valldemossa -->
  <arg name="bagfile" default="/home/uib/bagfiles/valldemossa/2016_09_21_valldemossa/2016_09_21_valldemossa/160921_1659/20160921_165907_0000.bag
                                  /home/uib/bagfiles/valldemossa/2016_09_21_valldemossa/2016_09_21_valldemossa/160921_1659/20160921_165907_0001.bag
                                  /home/uib/bagfiles/valldemossa/2016_09_21_valldemossa/2016_09_21_valldemossa/160921_1659/20160921_165907_0002.bag
                                  /home/uib/bagfiles/valldemossa/2016_09_21_valldemossa/2016_09_21_valldemossa/160921_1659/20160921_165907_0003.bag
                                  /home/uib/bagfiles/valldemossa/2016_09_21_valldemossa/2016_09_21_valldemossa/160921_1659/20160921_165907_0004.bag
                                  /home/uib/bagfiles/valldemossa/2016_09_21_valldemossa/2016_09_21_valldemossa/160921_1659/20160921_165907_0005.bag
                                  /home/uib/bagfiles/valldemossa/2016_09_21_valldemossa/2016_09_21_valldemossa/160921_1659/20160921_165907_0006.bag
                                  /home/uib/bagfiles/valldemossa/2016_09_21_valldemossa/2016_09_21_valldemossa/160921_1659/20160921_165907_0007.bag
                                  /home/uib/bagfiles/valldemossa/2016_09_21_valldemossa/2016_09_21_valldemossa/160921_1659/20160921_165907_0008.bag
                                  /home/uib/bagfiles/valldemossa/2016_09_21_valldemossa/2016_09_21_valldemossa/160921_1659/20160921_165907_0009.bag
                                  /home/uib/bagfiles/valldemossa/2016_09_21_valldemossa/2016_09_21_valldemossa/160921_1659/20160921_165907_0010.bag
                                  /home/uib/bagfiles/valldemossa/2016_09_21_valldemossa/2016_09_21_valldemossa/160921_1659/20160921_165907_0011.bag"/> 

  <!-- Play the bagfile -->
  <node pkg = "rosbag" type = "play" name = "rosbag" args = "-r 0.25 --clock $(arg bagfile)" />

  <!-- Run the stereo image proc -->
  <group>
    <include file="/home/uib/catkin_ws/src/image_pipeline/stereo_image_proc/launch/stereo_proc.launch">
    <arg name = "stereo" value = "$(arg stereo)" />
    <arg name = "resolution" value = "$(arg resolution)" />
    <arg name = "enable_decimate_x1" value = "$(arg enable_decimate_x1)" />
    <arg name = "enable_decimate_x2" value = "$(arg enable_decimate_x2)" />
    <arg name = "enable_decimate_x4" value = "$(arg enable_decimate_x4)" />
    </include>
  </group>

  <!-- Static TF's -->
  <!-- <node pkg="tf" type="static_transform_publisher" name="turbot_to_stereo_stick" args="0.4 0.0 0.8 0.0 0.0 0.0 /turbot/base_link /turbot/stereo_stick 30" />
  <node pkg="tf" type="static_transform_publisher" name="stereo_stick_to_stereo_base" args="0.0 0.0 0.0 1.57 0.0 1.57 /turbot/stereo_stick /turbot/stereo_down/base 30" />
  <node pkg="tf" type="static_transform_publisher" name="stereo_base_to_stereo" args="0.0 0.0 0.0 0.0 0.0 -1.57 /turbot/stereo_down/base /turbot/stereo_down 30" />
  <node pkg="tf" type="static_transform_publisher" name="stereo_to_left" args="-0.06 0.0 0.0 0.0 0.0 0.0 /turbot/stereo_down /turbot/stereo_down/left_optical 30" /> -->


  <!-- Viso2 -->
  <node pkg = "viso2_ros" type = "stereo_odometer" name = "stereo_odometer" output = "screen" if = "$(eval enable_decimate_x1 == true)">
    <remap from = "stereo" to = "$(arg camera)"/>
    <remap from = "image" to = "image_rect"/>
    <param name = "queue_size" value = "70"/>
    <param name = "approximate_sync" value = "$(arg images_approximate_sync)"/>
    <param name = "Viso2_processor" value = "$(arg viso2_processor)"/>
    <param name = "Bucketing" value = "$(arg bucketing)"/>
    <param name = "Feature_tracker" value = "$(arg feature_tracker)"/>
    <param name = "base_link_frame_id" value = "$(arg base_link)"/>
    <param name = "sensor_frame_id" value = "$(arg sensor)"/>
    <param name = "Epipolar_constrain" value = "$(arg epipolar_constrain)"/>
  </node>

  <node pkg = "viso2_ros" type = "stereo_odometer" name = "stereo_odometer" output = "screen" if = "$(eval enable_decimate_x2 == true)">
    <remap from = "stereo" to = "$(arg camera)"/>
    <remap from = "/stereo_down/left/image_rect" to = "/stereo_down/scaled_x2/left/image_rect"/>
    <remap from = "/stereo_down/right/image_rect" to = "/stereo_down/scaled_x2/right/image_rect"/> 
    <remap from = "image" to = "image_rect"/>
    <param name = "queue_size" value = "70"/>
    <param name = "approximate_sync" value = "$(arg images_approximate_sync)"/>
    <param name = "Viso2_processor" value = "$(arg viso2_processor)"/>
    <param name = "Bucketing" value = "$(arg bucketing)"/>
    <param name = "Feature_tracker" value = "$(arg feature_tracker)"/>
    <param name = "base_link_frame_id" value = "$(arg base_link)"/>
    <param name = "sensor_frame_id" value = "$(arg sensor)"/>
    <param name = "Epipolar_constrain" value = "$(arg epipolar_constrain)"/>
  </node>

  <node pkg = "viso2_ros" type = "stereo_odometer" name = "stereo_odometer" output = "screen" if = "$(eval enable_decimate_x4 == true)">
    <remap from = "stereo" to = "$(arg camera)"/>
    <remap from = "/stereo_down/left/image_rect" to = "/stereo_down/scaled_x4/left/image_rect"/>
    <remap from = "/stereo_down/right/image_rect" to = "/stereo_down/scaled_x4/right/image_rect"/> 
    <remap from = "image" to = "image_rect"/>
    <param name = "queue_size" value = "70"/>
    <param name = "approximate_sync" value = "$(arg images_approximate_sync)"/>
    <param name = "Viso2_processor" value = "$(arg viso2_processor)"/>
    <param name = "Bucketing" value = "$(arg bucketing)"/>
    <param name = "Feature_tracker" value = "$(arg feature_tracker)"/>
    <param name = "base_link_frame_id" value = "$(arg base_link)"/>
    <param name = "sensor_frame_id" value = "$(arg sensor)"/>
    <param name = "Epipolar_constrain" value = "$(arg epipolar_constrain)"/>
  </node>


</launch>
